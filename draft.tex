\documentclass[letterpaper,11pt]{article}
%--------------Document configuration begins--------------
\usepackage{fullpage}
\usepackage[numbers]{natbib} 	%\citet{jon90} --> Jones et al. [21], \citep{jon90} --> [21]
\usepackage[colorlinks]{hyperref}
%--------------Document configuration ends--------------

%Import personal commands 
\usepackage{commandscsp}		

%Load cleveref last
\usepackage{amsthm}
\usepackage[capitalize]{cleveref}
\usepackage{commands_theo} 			%Theorems, lemmas, proofs, etc

\title{\vspace{-1cm} \bf Constrained Shortest Path \vspace{-1.3cm}}
\author{}
\begin{document}
\maketitle


\section{Average HD}\label{sec:avg_hd}

We relax the definition of HD in two ways.
First, a LSHS needs to be locally sparse just ``in average''.
Second, we forget the strong limitation of hitting $S_r(v,\calQ)$ and ask only for the existence of a multiscale LSHS.

\begin{definition}[Average LSHS]
Given $r>0$ and a system $\calQ$, a set $C\subseteq V$ is an average $(h,r)$-LSHS if it hits $\calQ_r$ and is locally sparse in average, i.e.,
\[
\frac{1}{n}\sum_{v\in V} \abs{B_{2r}(v)\cap C} \leq h.
\]
\end{definition}

\begin{definition}[Average HD]
The system $\calQ$ has average HD $h$ if, for every $r>0$, there exists an average $(h,r)$-LSHS.
\anote{This can be further relaxed to only $r=2^i$. Furthermore, the value $h$ may vary across $r$.}
\end{definition}

\begin{theorem}\label{theo:preproc_avg}
If $\PS$ has average HD $h$, then we can obtain, in polynomial time, HL such that 
\[
\frac{1}{n}\sum_{v\in V} \abs{\Lf(v)} \leq h'\log D \quad \text{ and }\quad
\frac{1}{n}\sum_{v\in V} \abs{\Lb(v)} \leq h'\log D,
\]
where $h'=\Or(\Delta h\log (hn\Delta))$.
\end{theorem}
\begin{proof}
We only go over the preprocessing, since the construction does not change and the bound for the size easily follows. 
The objective is to obtain a set $C_i$ which is an average $(h',2^i)$-LSHS.
This is a minimum cost hitting set problem.
Indeed, we want to solve
\[
\min_{C\subseteq V} \sum_{v\in V}\abs{B_{2r}(v)\cap C}  \quad \text{ s.t. } \quad C \text{ hits } \PS_r.
\]
To see the equivalence, we assign to each node $u$ the cost $c(u)=\abs{\crl{v\in V: u\in B_{2r}(v)}}$.
Given a minimum cost hitting set problem with optimum value $\tau$, if the set system has VC-dimension $d$, the algorithm in \cite{vc_dim_hitting} finds a solution, in polynomial time, with cost at most $\Or(d\tau\log(d\tau))$.

By assumption, the minimum of the problem is at most $h\abs{V}$.
Now we do the same mapping as before, where the ground set is changed to $E$, hence the VC-dimension is 2 and now the minimum is at most $h\Delta n$.
We apply the algorithm in \cite{vc_dim_hitting} and obtain a solution $C_i$ with cost at most $\Or(h\Delta n\log(h\Delta n))$.
We have obtained an average $(h',r)$-LSHS as desired.
\end{proof}

\begin{remark}
The algorithm in \cref{theo:preproc_avg} makes one call to the VC-dimension solver for each $C_i$.
On the other hand, the algorithm in \cite{highway2013} calls up to $n$ times the solver for each LSHS.
Finally, there is an extra $\log n$ factor in the approximation guarantee, but now the value of $h$ can be much smaller.
\end{remark}

The notion of average HD is more suitable for the CSP.
In particular, the existence of LSHS is guaranteed by the partial witness property, so now the preprocessing can be done agnostic of the value of $\beta$.

\begin{theorem}
If the average HD of $\PE$ is $h_c$, then we can obtain, in polynomial time, HL to answer queries with budget $b$ in average time $\Or(bh_c'\log D)$ and the space requirements are $\Or(nB\cdot Bh_c'\log D)$.
\end{theorem}

\section{Relaxed Witness Property}\label{sec:rel_witness}

So far we have shown that the CHD is provably small when, for all sufficiently long efficient path, a fraction of it is shortest.
In \cref{sec:avg_hd} we discussed that average HD is enough to obtain good preprocessing algorithms, therefore we are now interested in the weaker notion of average CHD.
We will show that it is possible to obtain small average CHD under even less restrictive assumptions than the partial-witness.
We now allow for an additional \emph{lay witness set} $D$ such that, whenever a path $P$ does not have a good subpath, we can exhibit $v\in D$ hitting $D$.
This correspond to the intuition that, a few bad efficient paths should not completely ruin the algorithm. 

\begin{definition}[Weak Partial Witness]
Let $\beta\in\N\cup\crl{0}$.
We say that a path system $\calQ'$ is a weak $\beta$-witness of the path system $\calQ$ if, for every $r>0$, $\exists D_r\subseteq V$ such that, $\forall Q\in \calQ'_r$ either (1) $Q$ is $2^{-\beta}$-witnessed by $\calQ$ or (2) $Q$ is hit by $D_r$.
\end{definition} 
\anote{need to define what ``$2^{-\beta}$-witnessed by $\calQ$'' means before this.}

\begin{proposition}
Assume that $G$ is $\alpha$-doubling and let $\calQ'$ be weakly $2^{-\beta}$-witnessed by $\calQ$.
If the HD of $\calQ$ is $h$, then the average HD of $\calQ'$ is $h'\leq \alpha^{\beta}h+STUFF$
\end{proposition}
\begin{proof}
Let $r>0$, and $C$ be an $(h,2^{-\beta}r)$-SPHS for $\calQ$.
We show that $C\cup D_r$ has the desired properties.
Indeed, clearly is a hitting set for $\calQ'_r$ and we can compute
\begin{align*}
h'\leq \frac{1}{n}\sum_{v\in V} \abs{B_{2r}(v)\cap (C\cup D_r)}
&\leq \frac{1}{n}\prn*{\sum_{v\in V} \abs{B_{2r}(v)\cap C}+\sum_{v\in V} \abs{B_{2r}(v)\cap D_r}}\\
&\leq \frac{1}{n}\prn*{\sum_{v\in V} \alpha^\beta h+\sum_{v\in D_r} \abs{B_{2r}(v)}}\\
&\leq \alpha^\beta h + \frac{\abs{D_r}\alpha^{\log_2r+2}}{n}.
\end{align*}
In the second line we used that $C$ is sparse with respect to balls of radius $2^{-\beta+1}r$ and that $\sum_{v\in V} \abs{B_{2r}(v)\cap D_r}=\sum_{v\in D_r} \abs{B_{2r}(v)}$ by symmetry of the bi-directional balls.
In the last line we used that, by doubling dimension, balls of radius $r$ have at most $\alpha^{\log_2r+1}$ elements.
\end{proof}

\begin{definition}[Stretch]
An algorithm for CSP has stretch $\St\geq 1$ if, for every $s,t\in V$ and $b\leq B$, either outputs $\dist(s,t|b)$ when $\dist(s,t|b)\leq \St\dist(s,t)$ or outputs ``infeasible'' when $\dist(s,t|b)>\St\dist(s,t)$.
\end{definition}


Now we describe a realistic setting where the weak witness property is obeyed.
We need few overpasses, which are free edges connecting long free paths around a costly zone.
Denote $E_1=\crl{e\in E:c_e>0}$ and $E_0=\crl{e\in E:c_e=0}$.

\begin{definition}[Overpass]
For $r>0$, an edge $e=(u,v)$ is an $r$-overpass if: (1) one of $u$ or $v$ is the endpoint of a path in $\PS_{r/\St}$, (2) $\min(\dist(e,E_1),\dist(E_1,e))\leq 3r/2$ and (3) $e$ belongs to a path $Q\in\PE_{2r}\setminus\PS$.
\end{definition} 
\anote{Condition (3) is the less natural, but it can be removed without hurting the analysis.}


For every scale $r>0$, we ask for a \emph{bounded growth} condition controlling the number of $r$-overpasses.
Formally, we need $\abs{\crl{e\in E: e \text{ is an $r$-overpass}}}\leq g(r)$.
We also assume that edges are shortest paths between its endpoints, this property is clearly obeyed by road networks.

\begin{proposition}
With bounded growth, the network has the weak $\frac{1}{2}$-witness property.
\end{proposition}
\begin{proof}
Let $Q\in\PE$, call its endpoints $s,t$ and set $\ell(Q)=r$.
We will show how to obtain a vertex for the lay witness set in case $Q$ is not witnessed and then we bound the size of the set.
Assume that $Q\neq P(s,t)$, otherwise the path is trivially witnessed.
Let $(u,v)\in Q$ be such that $\ell(Q[s,v]),\ell(Q[u,t])\geq \frac{r}{2}$. 
If either $Q[s,v]$ or $Q[u,t]$ is a shortest path or $\ell_{uv}>r/2$, then $Q$ is witnessed, so we assume that all of these fail.

We claim that $uv$ is a $\frac{r}{2}$-overpass.
Indeed, it must be that $Q[s,v]$ or $Q[u,t]$ have stretch at most $\St$, otherwise $Q$ would have stretch larger than $\St$.
It follows that one of $P(s,v)$ or $P(u,t)$ belong to $\PS_{\frac{r}{2\St}}$ (property 1 of overpass).
Finally, we have $\ell(Q[s,v])+\ell(Q[u,t])=r+\ell_{uv}$ and since $\ell_{uv}<r/2$, one of $Q[s,v]$ or $Q[u,t]$ has length at most $3r/4$.
Since neither of these paths is shortest, it most be that both $P(s,v),P(u,t)$ have costly edges and thus one of $u,v$ is closer than $3r/4$ to $E_1$ (property 2 of overpass).
In this case we add $u$ to the lay witness set.
Now, for a fixed $r>0$, we need to add as many $g(r/2)$ nodes to $D_r$ to cover all the efficient paths that are not witnessed. 
The result follows.
\end{proof}

\section{Examples}

An important notion is that, if efficient paths oscillate too much between free and tolled edges, then it is very unlikely to observe partial witnesses.
In Figure~\ref{fig:nosubpath} we present a graph with no $\frac{1}{2}$-partial witness.
Every edge has unit length, dash edges have zero cost and solid edges have unit cost.
The path $uvwx$ is efficient, but every subpath that is shortest has length one.
The example can be generalized by placing the graph side by side many times.
This shows that, for any constant $k$ we can find examples with no $\frac{1}{k}$-partial witnesses.


\begin{figure}
\caption{Example with unit cost and no subpath property}
\label{fig:nosubpath}
\centering
\includegraphics[scale=1.3]{TexImg/Nosubpath.pdf}
\end{figure}

\bibliographystyle{plainnat}
\bibliography{biblio}

\end{document}
